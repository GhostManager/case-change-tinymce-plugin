/**
 * @copyright Â©Melqui Brito. All rights reserved.
 * @author Melqui Brito
 * @version 1.0.0 (2020-02-29)
 * @description Tinymce custom plugin for changing text case. It provides a tinymce menu button which can be displayed on tinymce's toolbar with the following menu items: "lower case", "UPPER CASE", "Sentence case", and "Title Case".
 */

(function () {
    tinymce.PluginManager.add('case',
        function (editor) {
            editor.ui.registry.addMenuButton('case', {
                icon: 'change-case',
                fetch: function (callback) {
                    let items = [
                        {
                            type: "menuitem",
                            text: 'lower case',
                            onAction: function () {
                                var selectedText = editor.dom.decode(editor.selection.getContent());
                                selectedText = selectedText.toLowerCase();
                                editor.selection.setContent(selectedText);
                                editor.save();
                                editor.isNotDirty = true;
                            }
                        },
                        {
                            type: "menuitem",
                            text: 'UPPER CASE',
                            onAction: function () {
                                var selectedText = editor.dom.decode(editor.selection.getContent());
                                selectedText = selectedText.toUpperCase();
                                editor.selection.setContent(selectedText);
                                editor.save();
                                editor.isNotDirty = true;
                            }
                        },
                        {
                            type: "menuitem",
                            text: 'Sentence case',
                            onAction: function () {
                                String.prototype.sentenceCase = function () {
                                    return this.toLowerCase().replace(/(^\s*\w|[\.\!\?]\s*\w)/g, function (c) {
                                        return c.toUpperCase()
                                    });
                                }
                                var selectedText = editor.dom.decode(editor.selection.getContent());
                                selectedText = selectedText.sentenceCase();
                                editor.selection.setContent(selectedText);
                                editor.save();
                                editor.isNotDirty = true;
                            }
                        },
                        {
                            type: "menuitem",
                            text: 'Tittle Case',
                            onAction: function () {
                                String.prototype.toTitleCase = function () {
                                    return this.toLowerCase().replace(/(^|[^a-z'])([a-z'])/g, function (m, p1, p2) {
                                        return p1 + p2.toUpperCase();
                                    });
                                }
                                var selectedText = editor.dom.decode(editor.selection.getContent());
                                selectedText = selectedText.toTitleCase();
                                editor.selection.setContent(selectedText);
                                editor.save();
                                editor.isNotDirty = true;
                            }
                        }
                    ]
                    callback(items);
                }
            });
        }
    );
})();
